rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // PUBLIC ACCESS: Allow anyone (even unauthenticated) to read portfolio content
    match /projects/{document=**} { allow read: if true; }
    match /expertise/{document=**} { allow read: if true; }
    match /blogs/{document=**} { allow read: if true; }

    // RESTRICTED ACCESS: Only logged-in users can read the source code (for RAG)
    // This prevents random bots from scraping your IP, but allows the AI to work for any signed-in user.
    match /source_code/{document=**} {
      allow read: if request.auth != null;
    }
    
    // ADMIN ONLY: Allow writes only for your specific UID
    // REPLACE 'YOUR_ADMIN_UID_HERE' with the UID you copied from the Admin Panel.
    match /{document=**} {
      allow write: if request.auth.uid == 'YOUR_ADMIN_UID_HERE';
    }
    
    // DIAGNOSTICS: Allow the admin to write to this path for testing
    match /diagnostics/{document=**} {
      allow write: if request.auth.uid == 'YOUR_ADMIN_UID_HERE';
      allow read: if request.auth.uid == 'YOUR_ADMIN_UID_HERE';
    }
    
    // CHAT LOGS: Users can write their own logs, Admin can read all
    match /chat_logs/{document=**} {
      allow create: if request.auth != null;
      allow read, delete: if request.auth.uid == 'YOUR_ADMIN_UID_HERE';
    }
  }
}
